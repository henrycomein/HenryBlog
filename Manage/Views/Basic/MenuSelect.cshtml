@{
    ViewBag.Title = "ParentMenuSelect";
    Layout = "~/Views/Shared/_Child.cshtml";
}
@section css{
    <link href="~/Scripts/ztree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet" />
}
@section scripts{
    <script src="~/Scripts/ztree/js/jquery.ztree.all-3.5.min.js"></script>
    <script src="~/Scripts/jquery.blockUI.js"></script>
    <script src="~/Scripts/lhgdialog/lhgdialogPlus.js"></script>
    <script type="text/javascript">
        var treeObj;
        $(function () {
            var callback=function(data)
            {
                treeObj = $.fn.zTree.init($("#menutree"), tools.ztreeops, data.items);
            }
            tools.postData('{dns}api/menu/tree', { id: '@ViewBag.ID' }, callback, "#baseContainer");
            $("#btn-select").click(function () {
                var selectedItem = treeObj.getCheckedNodes(true);
                if (selectedItem.length == 0) {
                    winAlert("请选择菜单！", true, false, false);
                } else {
                    var tempNode = selectedItem[0].getParentNode();
                    var fullMenu = [selectedItem[0].name];
                    while (tempNode != null)
                    {
                        fullMenu.push(tempNode.name);
                        tempNode = tempNode.getParentNode();
                    }
                    fullMenu.reverse();
                }
                W.setMenu(fullMenu, selectedItem[0].id);
                api.close();
            });
        });
    </script>
}
<div id="baseContainer" class="col-xs-12" style="height: 318px;overflow-y: auto;margin-bottom: 3px;">
    <ul id="menutree" class="ztree"></ul>
</div>
<div class="clearfix form-actions col-xs-12 fixed-bottom">
    <div class=" col-md-12 center">
        <button class="btn btn-info" type="button" id="btn-select">
            <i class="ace-icon fa fa-check bigger-110"></i>
            选择
        </button>
    </div>
</div>


